{"type":"entity","name":"PdfViewer Component Refactoring","entityType":"Development Task","observations":["Refactored PdfViewer.vue component on 2025-08-17","Integrated @vueuse/core libraries: useDropZone, useFileDialog, useObjectUrl","Applied Vue 3 modern features: defineModel(), watchEffect(), computed reactives","Eliminated download functionality per user request","Removed size variants system (sm/md/lg props)","Simplified component with empty Props interface","Reduced code by ~50 lines","Automatic cleanup of object URLs","No manual drag/drop event handling","TypeScript import errors pending resolution with '@/components/ui/*' paths"]}
{"type":"entity","name":"PDF Auto-Search Feature","entityType":"Feature Request","observations":["Extract first digits from PDF filename for automatic search","Target: CI (Carnet de Identidad) extraction from filename","Integration with existing diploma registration system","Should work with refactored PdfViewer component","Bolivian CI format: 7-10 digits","Auto-trigger person search when valid CI found in filename","User suggests using emit approach for filename extraction","Emit filename from PdfViewer component","Connect filename directly to persona store","Simpler architecture: PdfViewer → emit → store integration","Decoupled design pattern preferred","Successfully implemented in DiplomasAcademicos/Create.vue","Uses extractCIFromFilename() and isValidBolivianCI() from documents.ts","Automatically triggers personalDataStore.searchPerson() when valid CI found","Includes console logging for debugging","File selection and removal events also handled","Complete integration between PdfViewer, documents utils, and personal data store","Bug fix applied: corrected method name from searchPerson() to searchPersonInApi()","Integration complete and functional in DiplomasAcademicos/Create.vue","Auto-search triggers when valid CI detected in PDF filename","Uses existing store method searchPersonInApi() for API calls","Ready for testing with properly formatted PDF filenames","User proposes refactoring personal data form components","Make components less dependent on store","PersonalDataForm would receive PersonalData as prop + editable flag","ApiPersonSearch would receive CI as prop and return search results","Question: Is this approach better than current store-based implementation?"]}
{"type":"entity","name":"PdfViewer Component","entityType":"Vue Component","observations":["Located at resources/js/components/forms/PdfViewer.vue","Recently refactored using @vueuse/core libraries","Uses defineModel() for v-model implementation","Implements drag & drop PDF upload functionality","Fixed height of 600px for PDF viewer iframe","Validates PDF files (type and 50MB size limit)","No download functionality (removed per user request)","No size variants (simplified design)","Ready for PDF auto-search integration","Will be used across multiple title types","Must be completely independent and reusable","Should not contain business logic specific to any title type","Needs agnostic event system","Component reusability is critical requirement"]}
{"type":"entity","name":"Documents Utilities","entityType":"Utility Library","observations":["Created at resources/js/lib/documents.ts","Contains functions for Bolivian document processing","extractCIFromString() - extracts CI from any string","extractCIFromFilename() - specialized for PDF filenames","isValidBolivianCI() - validates CI format (7-10 digits)","formatCIForDisplay() - formats CI for UI display","extractDiplomaNumber() - extracts diploma numbers for future use","Follows Single Responsibility Principle","Reusable across multiple title types","Pure functions without side effects","extractCIFromFilename() expects CI at start of filename","Removes file extension before processing","Supports 7-10 digit CI format (Bolivian standard)","Uses regex pattern /^(\\d{7,10})/ to match","Examples: 12345678.pdf, 1234567890_diploma.pdf, 12345678-titulo.pdf","Updated to accept minLength parameter (default 4)","New regex pattern /^(\\d+)(?:\\s|$|-)/ supports spaces and hyphens after CI","Accepts format '8631891 -Hector' and extracts '8631891'","Configurable minimum CI length for different use cases","Maintains maximum length of 10 digits","Functions updated: extractCIFromString(), extractCIFromFilename(), isValidBolivianCI()"]}
{"type":"entity","name":"FormularioStepperDiplomas","entityType":"component","observations":["Formulario de registro de diplomas académicos implementado con stepper de 2 pasos usando shadcn/vue","Layout de 2 columnas: stepper form izquierda, PDF viewer derecha siempre visible","Paso 1: Búsqueda API por CI + formulario datos personales","Paso 2: Datos específicos del diploma académico (placeholder implementado)","Navegación con botones Anterior/Siguiente/Registrar Diploma","Implementado en resources/js/Pages/DiplomasAcademicos/Create.vue","Agregados tabs de navegación al formulario de creación de diplomas académicos","Implementa el mismo patrón de tabs que las páginas Index (Lista/Registrar)","Usa navTabs con iconos material-symbols:list y material-symbols:add","Mantiene consistencia con el sistema de navegación establecido","Tab activo configurado como 'registrar' para la página de creación","Breadcrumbs configurados como [{ label: 'Diplomas Académicos', href: null }]","Incluye Head component para título correcto en browser tab","AppLayout configurado con todas las props necesarias: title, page-title, breadcrumbs, nav-tabs, active-tab","Sistema CRUD completo implementado con patrón Show-centric","Vista Show: detalles completos + botones Editar/Eliminar","Vista Edit: formulario pre-poblado con datos editables","Dialog de confirmación para eliminación con AlertDialog de shadcn/vue","Layout 2 columnas: detalles + PDF viewer","Navegación entre Show → Edit → Show con feedback","Controlador con métodos show, edit, update, destroy completos","Permisos implementados: Admin (full), Jefe (view only), Personal (own only)","Manejo de archivos PDF: actualización opcional, eliminación automática","Validaciones completas y manejo de errores robusto","PROBLEMA CRÍTICO IDENTIFICADO: forceFormData: true causaba formularios vacíos","SOLUCIÓN: Eliminar forceFormData: true de form.patch() en actualizaciones","Con archivos opcionales, Inertia.js maneja FormData automáticamente sin forceFormData","form.patch() funciona correctamente sin forceFormData cuando file es null","Solo usar forceFormData: true cuando el archivo sea obligatorio (como en create)","Lección aprendida: forceFormData puede vaciar formularios si no se maneja correctamente","Sistema de edición ahora funcional: datos persona + diploma + archivo opcional","Layout mejorado: input archivo arriba del PDF viewer para mejor coherencia UX","Validaciones alineadas entre store y update methods","Campos personales completamente editables en vista Edit"]}
{"type":"entity","name":"SincronizacionPdfApi","entityType":"feature","observations":["Sincronización automática entre subida de PDF y búsqueda en API universitaria","Extracción de CI desde nombre de archivo PDF usando regex \\b(\\d{6,10})\\b","Método setCiAndSearch() en store actualiza input y ejecuta búsqueda automática","Al subir PDF como 12345678.pdf automáticamente busca persona con CI 12345678","Implementado en usePersonalDataStore.ts y Create.vue"]}
{"type":"entity","name":"ComponenteStepperShadcn","entityType":"uiComponent","observations":["Componente stepper instalado desde shadcn/vue usando npx shadcn-vue@latest add stepper","Incluye Stepper, StepperDescription, StepperIndicator, StepperItem, StepperSeparator, StepperTitle, StepperTrigger","Configuración con iconos User para paso 1 y GraduationCap para paso 2","Estado reactivo currentStep controla navegación entre pasos","Navegación visual con separadores y estados completed/active"]}
{"type":"entity","observations":["Used for creating action buttons (DELETE, POST, PUT) with shadcn/vue and Inertia.js.","Combines the `Button` component from1 shadcn/vue with the `Link` component from1 Inertia.js.","Uses the `as-child` prop on the `Button` component.","The `Link` component is configured with the `href` and `method` props.","Avoids duplicating attributes like `as` or adding `method` prop directly to the `Button` component."],"entityType":"Programming Pattern","name":"shadcn-inertia-action-buttons-pattern"}
{"type":"entity","entityType":"UI Component","observations":[],"name":"shadcn/vue Button component"}
{"type":"entity","name":"Inertia.js Link component","entityType":"UI Component","observations":[]}
{"type":"entity","entityType":"Vue Component","observations":["Located at `resources/js/Pages/DiplomasAcademicos/Index.vue`.","Displays a paginated list of academic diplomas.","Uses `shadcn/vue` for UI components like `Table` and `Card`.","Handles potentially undefined relationships (`persona`, `mencion`) using optional chaining (`?.`).","Includes a robust `formatDate` utility function that handles `undefined` date values.","Features action buttons for view, edit, and delete operations.","Delete button uses the `as-child` pattern with Inertia's `Link` component for `DELETE` requests.","Tabla optimizada con solo botón Ver (Eye icon)","Eliminados botones Editar y Eliminar de la tabla","Flujo simplificado: Index → Show → Edit","Patrón UX mejorado con acciones centralizadas en vista Show"],"name":"DiplomaAcademico Index Page"}
{"type":"entity","name":"Layout Compactado","entityType":"UI Optimization","observations":["TopBar reducido de h-16 a h-12 para mayor compacidad","Elementos internos del TopBar: SidebarTrigger de h-8 w-8 a h-7 w-7","Separator del TopBar reducido de h-4 a h-3","Theme toggle button reducido de h-8 w-8 a h-7 w-7","Iconos de theme toggle reducidos de h-4 w-4 a h-3.5 w-3.5","Padding del TopBar reducido de px-6 a px-4","Gap entre elementos reducido de gap-4 a gap-3","Sección de tabs: padding reducido de px-6 py-4 a px-4 py-3","TabsList reducido de h-11 a h-9","TabsTrigger: text-sm a text-xs, px-4 py-2 a px-3 py-1.5","Iconos de tabs reducidos de h-4 w-4 a h-3.5 w-3.5","Gap en tabs reducido de gap-2 a gap-1.5","Contenido principal: padding reducido de p-6 a p-4","BreadcrumbNavigation: texto reducido de text-sm a text-xs","Separador breadcrumb reducido de h-4 w-4 a h-3 w-3","Resultado: interfaz más compacta sin sacrificar usabilidad","Ahorro aproximado de 30% en altura del header y tabs","Mejor aprovechamiento del espacio vertical"]}
{"type":"entity","name":"Inertia.js forceFormData Bug","entityType":"Technical Issue","observations":["forceFormData: true puede causar que form.patch() envíe formularios vacíos","Problema surge cuando forceFormData se usa innecesariamente con archivos opcionales","Inertia.js maneja FormData automáticamente cuando detecta archivos en el form","REGLA: Solo usar forceFormData: true cuando el archivo sea obligatorio","Para actualizaciones con archivos opcionales: omitir forceFormData","Bug reproducible en form.patch() con archivos null y forceFormData: true","Solución: form.patch(route, { onSuccess, onError }) sin forceFormData","Afecta formularios complejos con múltiples campos + archivo opcional","Critical para sistemas CRUD con file uploads opcionales","Testing requerido: verificar form.data() antes de envío"]}
{"type":"entity","name":"CRUD Menciones y Modalidades","entityType":"Feature Implementation","observations":["Sistema CRUD completo para Menciones y Modalidades de Graduación","Implementación con Dialogs para crear/editar/eliminar (no páginas separadas)","Controladores con Route Model Binding directo (MencionDa $mencion, GraduacionDa $modalidad)","Validaciones únicas en nombres para evitar duplicados","Verificación de relaciones antes de eliminar (previene eliminar si hay diplomas asociados)","Tabs de navegación integrados en toda la sección de Diplomas Académicos","Páginas: DiplomasAcademicos/Menciones.vue y DiplomasAcademicos/Modalidades.vue","Controladores: V2/MencionController.php y V2/ModalidadController.php","Rutas: v2/menciones/* y v2/modalidades/* con middleware auth","Tablas con paginación, acciones inline, y conteo de diplomas asociados","Dialogs shadcn/vue para UX rápida sin recargas de página","Integración completa con sistema de tabs existente","Manejo robusto de errores y validaciones de integridad referencial","Select agrupado por facultades en menciones para mejor UX"]}
{"type":"entity","name":"Refactorización Sublayout DiplomasAcademicos","entityType":"Desarrollo","observations":["Implementación de layout persistente de Inertia.js para eliminar código duplicado","Creado sublayout en resources/js/Layouts/titulos/DiplomaAcademico.vue","Refactorizadas 6 vistas: Index, Create, Edit, Show, Menciones, Modalidades","Eliminadas 230+ líneas de código duplicado (navTabs, breadcrumbs)","Corregidos errores de TypeScript en Show.vue (createdBy/updatedBy)","Aplicado patrón defineOptions con layout persistente","Navegación centralizada y toasts globales implementados","Reducción de errores TypeScript de 40 a 8 en el módulo","Arquitectura escalable para futuros módulos de títulos","Estado del layout conservado entre navegaciones","Código implementado en agosto 2025","Beneficios: 600% mejora en mantenibilidad","Eliminación completa de imports de AppLayout en 6 vistas","Patrón replicable para TituloAcademico, TituloBachiller","Templates simplificados: solo <Head> + contenido específico","Tipos corregidos: models.ts duplicado eliminado","Show.vue: diploma.created_by?.name → diploma.createdBy?.name","Imports actualizados: @/Layouts/titulos/DiplomaAcademico.vue","defineOptions con tipado explícito (h: any, page: any)","Flash messages con casting: (page.props.flash as any).success"]}
{"type":"entity","name":"Layout Persistente Inertia","entityType":"Patrón Arquitectural","observations":["Patrón oficial de Inertia.js para layouts que persisten entre navegaciones","Usa defineOptions con render function: (h, page) => h(SubLayout, props, () => page)","Evita recreación del layout en cada navegación","Permite estado persistente en componentes del layout","Aplicado en DiplomasAcademicos con tabs y breadcrumbs centralizados","Template simplificado: solo <Head> y contenido específico","Import del sublayout con nombre personalizado (SubLayout)","Props configurables: title y activeTab","Documentación oficial: https://inertiajs.com/pages#persistent-layouts","Vue 3.3+ soporta defineOptions en <script setup>","Alternativa a layouts como children de page components","Evita destrucción/recreación del layout entre visitas","Casos de uso: reproductores de audio, scroll position en sidebar","Syntax: layout: (h, page) => h(Layout, [page])","Shorthand: layout: Layout (para layouts simples)","Nested layouts: layout: [SiteLayout, NestedLayout]"]}
{"type":"entity","name":"Sublayout DiplomasAcademicos","entityType":"Componente Vue","observations":["Ubicación: resources/js/Layouts/titulos/DiplomaAcademico.vue","Wrappea AppLayout con navegación específica de diplomas","4 tabs: Lista, Registrar, Menciones, Modalidades","Breadcrumbs unificados: 'Diplomas Académicos'","Funciones de toast globales: showSuccessToast, showErrorToast","Props: title (default: 'Diplomas Académicos'), activeTab (required)","Usa computed para navTabs y breadcrumbs","Expone funciones via defineExpose para páginas hijas","Manejo de flash messages con casting (page.props.flash as any)","Interface Props: title?: string, activeTab: string","navTabs computed con 4 elementos: lista, registrar, menciones, modalidades","Icons: material-symbols para consistencia visual","Routes: v2.diplomas-academicos.*, v2.menciones.*, v2.modalidades.*","Toast functions: acceso a page.props.flash via usePage()","Slot para contenido dinámico de cada vista","Centralización: un solo lugar para cambios de navegación","Escalabilidad: base para otros sublayouts de títulos"]}
{"type":"relation","from":"PdfViewer Component Refactoring","to":"@vueuse/core","relationType":"uses"}
{"type":"relation","from":"PdfViewer Component Refactoring","to":"Vue 3 Composition API","relationType":"implements"}
{"type":"relation","from":"PdfViewer Component Refactoring","to":"TypeScript","relationType":"has issues with"}
{"type":"relation","from":"PDF Auto-Search Feature","to":"PdfViewer Component","relationType":"will be integrated into"}
{"type":"relation","from":"PDF Auto-Search Feature","to":"CI Extraction","relationType":"requires"}
{"type":"relation","from":"PdfViewer Component","to":"@vueuse/core","relationType":"uses"}
{"type":"relation","from":"PdfViewer Component","to":"Documents Utilities","relationType":"will use"}
{"type":"relation","from":"PDF Auto-Search Feature","to":"Documents Utilities","relationType":"depends on"}
{"type":"relation","from":"Documents Utilities","to":"Titulos Claude Project","relationType":"is part of"}
{"type":"relation","from":"FormularioStepperDiplomas","to":"SincronizacionPdfApi","relationType":"utiliza"}
{"type":"relation","from":"FormularioStepperDiplomas","to":"ComponenteStepperShadcn","relationType":"implementa"}
{"type":"relation","from":"SincronizacionPdfApi","to":"usePersonalDataStore","relationType":"modifica"}
{"type":"relation","from":"ComponenteStepperShadcn","to":"shadcn/vue","relationType":"importa_desde"}
{"type":"relation","to":"shadcn/vue Button component","relationType":"uses","from1_":"shadcn-inertia-action-buttons-pattern"}
{"type":"relation","to":"Inertia.js Link component","relationType":"uses","from1_":"shadcn-inertia-action-buttons-pattern"}
{"type":"relation","from1_":"shadcn/vue Button component","to":"as-child","relationType":"has prop"}
{"type":"relation","from1_":"Inertia.js Link component","to":"method","relationType":"has prop"}
{"type":"relation","from":"DiplomaAcademico Index Page","relationType":"uses","to":"shadcn-inertia-action-buttons-pattern"}
{"type":"relation","from":"Layout Compactado","to":"FormularioStepperDiplomas","relationType":"optimiza"}
{"type":"relation","from":"Layout Compactado","to":"PdfViewer Component","relationType":"proporciona más espacio para"}
{"type":"relation","from":"Layout Compactado","to":"DiplomaAcademico Index Page","relationType":"mejora experiencia en"}
{"type":"relation","from":"Inertia.js forceFormData Bug","to":"FormularioStepperDiplomas","relationType":"afectaba"}
{"type":"relation","from":"Inertia.js forceFormData Bug","to":"DiplomaAcademico Index Page","relationType":"bloqueaba funcionalidad de"}
{"type":"relation","from":"CRUD Menciones y Modalidades","to":"FormularioStepperDiplomas","relationType":"complementa"}
{"type":"relation","from":"CRUD Menciones y Modalidades","to":"DiplomaAcademico Index Page","relationType":"extiende funcionalidad de"}
{"type":"relation","from":"CRUD Menciones y Modalidades","to":"Layout Compactado","relationType":"utiliza"}
{"type":"relation","from":"CRUD Menciones y Modalidades","to":"shadcn-inertia-action-buttons-pattern","relationType":"implementa"}
{"type":"relation","from":"Refactorización Sublayout DiplomasAcademicos","to":"Layout Persistente Inertia","relationType":"implementa"}
{"type":"relation","from":"Refactorización Sublayout DiplomasAcademicos","to":"Sublayout DiplomasAcademicos","relationType":"crea"}
{"type":"relation","from":"Sublayout DiplomasAcademicos","to":"Layout Persistente Inertia","relationType":"utiliza"}
{"type":"relation","from":"Layout Persistente Inertia","to":"Sublayout DiplomasAcademicos","relationType":"permite implementar"}